# SimTradeData - é«˜æ•ˆé‡åŒ–äº¤æ˜“æ•°æ®ä¸‹è½½å·¥å…·

> ğŸš€ **ä¼˜åŒ–çš„BaoStockæ•°æ®ä¸‹è½½** | ğŸ“Š **PTradeæ ¼å¼å…¼å®¹** | âš¡ **APIè°ƒç”¨å‡å°‘33%**

**SimTradeData** æ˜¯ä¸º [SimTradeLab](https://github.com/kay_ou/SimTradeLab) è®¾è®¡çš„é«˜æ•ˆæ•°æ®ä¸‹è½½å·¥å…·ã€‚é€šè¿‡æ™ºèƒ½çš„APIè°ƒç”¨ä¼˜åŒ–ï¼Œåœ¨å•æ¬¡è¯·æ±‚ä¸­è·å–å¤šç§æ•°æ®ç±»å‹ï¼Œæ˜¾è‘—æå‡ä¸‹è½½æ•ˆç‡ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ¯ æ€§èƒ½ä¼˜åŒ–
- **ç»Ÿä¸€æ•°æ®è·å–**: ä¸€æ¬¡APIè°ƒç”¨åŒæ—¶è·å–è¡Œæƒ…ã€ä¼°å€¼ã€çŠ¶æ€æ•°æ®
- **APIè°ƒç”¨ä¼˜åŒ–**: ç›¸æ¯”ä¼ ç»Ÿæ–¹æ³•å‡å°‘ **33%** çš„APIè°ƒç”¨æ¬¡æ•°
- **å¢é‡æ›´æ–°æ”¯æŒ**: æ™ºèƒ½è¯†åˆ«å·²ä¸‹è½½æ•°æ®ï¼Œä»…æ›´æ–°å¢é‡éƒ¨åˆ†
- **æ–­ç‚¹ç»­ä¼ **: ä¸­æ–­åè‡ªåŠ¨è·³è¿‡å·²å®Œæˆçš„è‚¡ç¥¨

### ğŸ“¦ æ•°æ®å®Œæ•´æ€§
- **å¸‚åœºæ•°æ®**: OHLCVæ—¥çº¿æ•°æ®
- **ä¼°å€¼æŒ‡æ ‡**: PE/PB/PS/PCF/æ¢æ‰‹ç‡
- **å¤æƒå› å­**: å‰å¤æƒ/åå¤æƒå› å­
- **è‚¡ç¥¨å…ƒæ•°æ®**: ä¸Šå¸‚æ—¥æœŸã€é€€å¸‚æ—¥æœŸã€è¡Œä¸šåˆ†ç±»
- **æŒ‡æ•°æˆåˆ†è‚¡**: ä¸Šè¯50ã€æ²ªæ·±300ã€ä¸­è¯500ç­‰
- **äº¤æ˜“æ—¥å†**: å®Œæ•´çš„Aè‚¡äº¤æ˜“æ—¥å†

## ğŸ“¦ ç”Ÿæˆçš„æ•°æ®æ–‡ä»¶

| æ–‡ä»¶å | è¯´æ˜ | æ•°æ®å†…å®¹ |
|--------|------|----------|
| `ptrade_data.h5` | ä¸»æ•°æ®æ–‡ä»¶ | è‚¡ç¥¨è¡Œæƒ…(OHLCV)ã€åŸºå‡†æŒ‡æ•°ã€é™¤æƒé™¤æ¯ã€è‚¡ç¥¨å…ƒæ•°æ®ã€äº¤æ˜“æ—¥å† |
| `ptrade_fundamentals.h5` | ä¼°å€¼æ•°æ® | æ¯æ—¥ä¼°å€¼æŒ‡æ ‡(PE/PB/PS/PCF/æ¢æ‰‹ç‡) |
| `ptrade_adj_pre.h5` | å¤æƒå› å­ | æ¯åªè‚¡ç¥¨çš„å†å²å¤æƒå› å­åºåˆ— |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/kay-ou/SimTradeData.git
cd SimTradeData

# å®‰è£…ä¾èµ–(ä½¿ç”¨ Poetry)
poetry install

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
poetry shell
```

### 2. ä¸‹è½½æ•°æ®

```bash
# ã€é¦–æ¬¡ä¸‹è½½ã€‘ä¸‹è½½å…¨éƒ¨æ•°æ®ï¼ˆ2017è‡³ä»Šï¼‰
poetry run python scripts/download_efficient.py

# ã€å¢é‡æ›´æ–°ã€‘æ›´æ–°æœ€è¿‘7å¤©æ•°æ®
poetry run python scripts/download_efficient.py --incremental 7

# ã€å¢é‡æ›´æ–°ã€‘æ›´æ–°æœ€è¿‘30å¤©æ•°æ®
poetry run python scripts/download_efficient.py --incremental 30
```

### 3. åœ¨ SimTradeLab ä¸­ä½¿ç”¨

ç”Ÿæˆçš„ HDF5 æ–‡ä»¶å¯ç›´æ¥æ”¾å…¥ SimTradeLab çš„æ•°æ®ç›®å½•ä½¿ç”¨:

```bash
# å¤åˆ¶ç”Ÿæˆçš„æ–‡ä»¶åˆ° SimTradeLab æ•°æ®ç›®å½•
cp data/*.h5 /path/to/SimTradeLab/data/
```

## âš¡ æ€§èƒ½ä¼˜åŒ–è¯¦è§£

### ä¼ ç»Ÿæ–¹æ³• vs ä¼˜åŒ–æ–¹æ³•

**ä¼ ç»Ÿæ–¹æ³•**ï¼ˆæ¯è‚¡6æ¬¡APIè°ƒç”¨ï¼‰:
```
1. è·å–å¸‚åœºæ•°æ®ï¼ˆOHLCVï¼‰
2. è·å–ä¼°å€¼æ•°æ®ï¼ˆPE/PB/PSï¼‰
3. è·å–STçŠ¶æ€
4. è·å–å¤æƒå› å­
5. è·å–åŸºæœ¬ä¿¡æ¯
6. è·å–è¡Œä¸šåˆ†ç±»
```

**ä¼˜åŒ–æ–¹æ³•**ï¼ˆæ¯è‚¡4æ¬¡APIè°ƒç”¨ï¼‰:
```
1. ç»Ÿä¸€è·å–ï¼ˆå¸‚åœº+ä¼°å€¼+çŠ¶æ€ï¼‰â† ä¸‰åˆä¸€ï¼
2. è·å–å¤æƒå› å­
3. è·å–åŸºæœ¬ä¿¡æ¯
4. è·å–è¡Œä¸šåˆ†ç±»
```

**æ€§èƒ½å¯¹æ¯”**:
| æŒ‡æ ‡ | ä¼ ç»Ÿæ–¹æ³• | ä¼˜åŒ–æ–¹æ³• | æå‡ |
|------|---------|---------|------|
| APIè°ƒç”¨/è‚¡ | 6æ¬¡ | 4æ¬¡ | **-33%** |
| 5000è‚¡æ€»è°ƒç”¨ | 30,000æ¬¡ | 20,000æ¬¡ | èŠ‚çœ10,000æ¬¡ |

### ä¸‹è½½æ—¶é—´ä¼°ç®—

ä»¥5000åªè‚¡ç¥¨ä¸ºä¾‹ï¼š

| æ¨¡å¼ | æ—¶é—´èŒƒå›´ | é¢„è®¡è€—æ—¶ | è¯´æ˜ |
|------|---------|---------|------|
| é¦–æ¬¡å®Œæ•´ä¸‹è½½ | 2017-01-01 è‡³ä»Š | ~8-10å°æ—¶ | åŒ…å«æ‰€æœ‰å†å²æ•°æ® |
| å¢é‡æ›´æ–°(7å¤©) | æœ€è¿‘7å¤© | ~30-40åˆ†é’Ÿ | ä»…æ›´æ–°æœ€æ–°æ•°æ® |
| å¢é‡æ›´æ–°(30å¤©) | æœ€è¿‘30å¤© | ~2-3å°æ—¶ | é€‚åˆæœˆåº¦æ›´æ–° |

## ğŸ—ï¸ é¡¹ç›®æ¶æ„

```
SimTradeData/
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ download_efficient.py      # ä¸»ä¸‹è½½è„šæœ¬ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
â”œâ”€â”€ simtradedata/
â”‚   â”œâ”€â”€ fetchers/
â”‚   â”‚   â”œâ”€â”€ baostock_fetcher.py   # BaoStockåŸºç¡€å°è£…
â”‚   â”‚   â””â”€â”€ unified_fetcher.py    # ç»Ÿä¸€æ•°æ®è·å–ï¼ˆæ ¸å¿ƒä¼˜åŒ–ï¼‰
â”‚   â”œâ”€â”€ processors/
â”‚   â”‚   â””â”€â”€ data_splitter.py      # æ•°æ®åˆ†æµå¤„ç†
â”‚   â”œâ”€â”€ writers/
â”‚   â”‚   â””â”€â”€ h5_writer.py          # HDF5å†™å…¥ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ code_utils.py         # å·¥å…·å‡½æ•°
â”œâ”€â”€ data/                          # ç”Ÿæˆçš„H5æ–‡ä»¶
â””â”€â”€ docs/                          # æ–‡æ¡£
```

### æ ¸å¿ƒæ¨¡å—è¯´æ˜

**1. UnifiedDataFetcher** - ç»Ÿä¸€æ•°æ®è·å–
- ä¸€æ¬¡APIè°ƒç”¨è·å–å¤šç§æ•°æ®ç±»å‹
- å‡å°‘ç½‘ç»œè¯·æ±‚æ¬¡æ•°
- è‡ªåŠ¨å¤„ç†æ•°æ®ç±»å‹è½¬æ¢

**2. DataSplitter** - æ™ºèƒ½æ•°æ®åˆ†æµ
- å°†ç»Ÿä¸€æ•°æ®åˆ†æµåˆ°ä¸åŒç›®æ ‡
- å¸‚åœºæ•°æ® â†’ `ptrade_data.h5/stock_data`
- ä¼°å€¼æ•°æ® â†’ `ptrade_fundamentals.h5/valuation`
- çŠ¶æ€æ•°æ® â†’ å†…å­˜ç¼“å­˜ï¼ˆç”¨äºæ„å»ºå†å²ï¼‰

**3. HDF5Writer** - é«˜æ•ˆæ•°æ®å†™å…¥
- æ”¯æŒå¢é‡è¿½åŠ å†™å…¥
- è‡ªåŠ¨å»é‡å’Œåˆå¹¶
- å‹ç¼©å­˜å‚¨ï¼ˆbloscå‹ç¼©ç®—æ³•ï¼‰

## ğŸ“Š æ•°æ®ç»“æ„

### ptrade_data.h5
```
/stock_data/{symbol}     - è‚¡ç¥¨OHLCVæ•°æ®
/exrights/{symbol}       - é™¤æƒé™¤æ¯æ•°æ®
/stock_metadata          - è‚¡ç¥¨å…ƒæ•°æ®ï¼ˆåç§°ã€ä¸Šå¸‚æ—¥æœŸç­‰ï¼‰
/trade_days              - äº¤æ˜“æ—¥å†
/benchmark               - åŸºå‡†æŒ‡æ•°æ•°æ®
/metadata                - å…¨å±€å…ƒæ•°æ®ï¼ˆåŒ…å«æŒ‡æ•°æˆåˆ†è‚¡å†å²ï¼‰
```

### ptrade_fundamentals.h5
```
/valuation/{symbol}      - ä¼°å€¼æŒ‡æ ‡ï¼ˆPE/PB/PS/PCF/æ¢æ‰‹ç‡ï¼‰
```

### ptrade_adj_pre.h5
```
/{symbol}                - åå¤æƒå› å­åºåˆ—
```

è¯¦ç»†æ•°æ®ç»“æ„è¯·å‚è€ƒ: [H5_DATA_STRUCTURE.md](docs/H5_DATA_STRUCTURE.md)

## ğŸ”§ é…ç½®è¯´æ˜

ç¼–è¾‘ `scripts/download_efficient.py` ä¸­çš„é…ç½®å‚æ•°:

```python
# è¾“å‡ºç›®å½•é…ç½®
OUTPUT_DIR = "data"            # è¾“å‡ºç›®å½•ï¼ˆHDF5æ–‡ä»¶ä¿å­˜ä½ç½®ï¼‰
LOG_FILE = "data/download_efficient.log"  # æ—¥å¿—æ–‡ä»¶

# æ—¥æœŸèŒƒå›´é…ç½®
START_DATE = "2017-01-01"      # èµ·å§‹æ—¥æœŸ
END_DATE = None                # ç»“æŸæ—¥æœŸï¼ˆNoneè¡¨ç¤ºå½“å‰æ—¥æœŸï¼‰
INCREMENTAL_DAYS = None        # å¢é‡å¤©æ•°ï¼ˆNoneè¡¨ç¤ºå®Œæ•´ä¸‹è½½ï¼‰

# æ‰¹æ¬¡é…ç½®
BATCH_SIZE = 20                # æ¯æ‰¹å¤„ç†è‚¡ç¥¨æ•°
```

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### Python API ä½¿ç”¨

```python
from simtradedata.fetchers.unified_fetcher import UnifiedDataFetcher
from simtradedata.processors.data_splitter import DataSplitter
from simtradedata.writers.h5_writer import HDF5Writer

# åˆå§‹åŒ–ç»„ä»¶
fetcher = UnifiedDataFetcher()
splitter = DataSplitter()
writer = HDF5Writer(output_dir="data")  # è¾“å‡ºåˆ°dataç›®å½•

fetcher.login()

try:
    # 1. ç»Ÿä¸€è·å–æ•°æ®ï¼ˆä¸€æ¬¡APIè°ƒç”¨ï¼‰
    unified_data = fetcher.fetch_unified_daily_data(
        symbol="600000.SS",
        start_date="2024-01-01",
        end_date="2024-11-22"
    )

    # 2. åˆ†æµæ•°æ®
    split_data = splitter.split_data(unified_data)

    # 3. å†™å…¥ä¸åŒæ–‡ä»¶
    if 'market' in split_data:
        writer.write_market_data("600000.SS", split_data['market'])

    if 'valuation' in split_data:
        writer.write_valuation("600000.SS", split_data['valuation'])

finally:
    fetcher.logout()
```

### æ‰¹é‡ä¸‹è½½

```python
from scripts.download_efficient import download_all_data

# å®Œæ•´ä¸‹è½½
download_all_data(incremental_days=None)

# å¢é‡æ›´æ–°æœ€è¿‘7å¤©
download_all_data(incremental_days=7)
```

## ğŸ“š æ–‡æ¡£

| æ–‡æ¡£ | è¯´æ˜ | çŠ¶æ€ |
|------|------|------|
| [H5_DATA_STRUCTURE.md](docs/H5_DATA_STRUCTURE.md) | HDF5æ–‡ä»¶è¯¦ç»†æ•°æ®ç»“æ„ | âœ… å®Œæˆ |
| [BaoStock_Data_Mapping.md](docs/BaoStock_Data_Mapping.md) | BaoStockæ•°æ®æ˜ å°„æ–¹æ¡ˆ | âœ… å®Œæˆ |
| [BaoStock API Reference](docs/reference/baostock_api/) | BaoStock APIæ–‡æ¡£ | âœ… å®Œæˆ |

## âš ï¸ æ³¨æ„äº‹é¡¹

### BaoStocké™åˆ¶
- **ä¸æ”¯æŒå¹¶å‘**: BaoStockä¸æ”¯æŒå¤šçº¿ç¨‹/å¤šè¿›ç¨‹ï¼Œæ‰€æœ‰ä¸‹è½½å‡ä¸ºé¡ºåºæ‰§è¡Œ
- **æ¯æ—¥é™é¢**: å»ºè®®æ§åˆ¶åœ¨åˆç†èŒƒå›´å†…ï¼Œé¿å…é¢‘ç¹å¤§é‡è¯·æ±‚
- **ç½‘ç»œç¨³å®šæ€§**: å»ºè®®åœ¨ç½‘ç»œç¨³å®šçš„ç¯å¢ƒä¸‹è¿è¡Œ

### æ•°æ®è´¨é‡
- **æ•°æ®æ¥æº**: æ‰€æœ‰æ•°æ®æ¥è‡ªBaoStockå…è´¹æ•°æ®æº
- **å…è´£å£°æ˜**: æ•°æ®ä»…ä¾›å­¦ä¹ ç ”ç©¶ä½¿ç”¨ï¼Œè¯·å‹¿ç”¨äºå®ç›˜äº¤æ˜“
- **è´¨é‡æ£€æŸ¥**: å»ºè®®ä¸‹è½½å®Œæˆåä½¿ç”¨éªŒè¯å·¥å…·æ£€æŸ¥æ•°æ®å®Œæ•´æ€§

### å¢é‡æ›´æ–°å»ºè®®
- **é¦–æ¬¡ä¸‹è½½**: å®Œæ•´ä¸‹è½½2017å¹´è‡³ä»Šçš„æ‰€æœ‰æ•°æ®
- **æ—¥å¸¸æ›´æ–°**: ä½¿ç”¨ `--incremental 7` æ›´æ–°æœ€è¿‘ä¸€å‘¨
- **æœˆåº¦æ›´æ–°**: ä½¿ç”¨ `--incremental 30` æ›´æ–°æœ€è¿‘ä¸€æœˆ
- **æ•°æ®åˆå¹¶**: ç¨‹åºä¼šè‡ªåŠ¨åˆå¹¶æ–°æ—§æ•°æ®ï¼Œå»é™¤é‡å¤

## ğŸ”„ ç‰ˆæœ¬å†å²

### v0.2.0 (2025-11-22) - æ€§èƒ½ä¼˜åŒ–ç‰ˆ
- âœ… å®ç°ç»Ÿä¸€æ•°æ®è·å–ï¼ŒAPIè°ƒç”¨å‡å°‘33%
- âœ… ä¼˜åŒ–HDF5å†™å…¥é€»è¾‘ï¼Œç§»é™¤ä¸å¿…è¦çš„çº¿ç¨‹é”
- âœ… å¢å¼ºå¢é‡æ›´æ–°æœºåˆ¶ï¼Œæ”¯æŒæ•°æ®åˆå¹¶å»é‡
- âœ… ä»£ç ç²¾ç®€54%ï¼ˆ7054è¡Œ â†’ 3250è¡Œï¼‰
- âœ… åˆ é™¤æœªä½¿ç”¨çš„æ–¹æ³•å’Œæ¨¡å—

### v0.1.0 (2024-11-14) - åˆå§‹ç‰ˆæœ¬
- âœ… åŸºç¡€æ•°æ®ä¸‹è½½åŠŸèƒ½
- âœ… BaoStockæ•°æ®æºé›†æˆ
- âœ… PTradeæ ¼å¼å…¼å®¹

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- **SimTradeLab**: https://github.com/kay_ou/SimTradeLab
- **BaoStock**: http://baostock.com/

## ğŸ“® è”ç³»æ–¹å¼

- **Issues**: https://github.com/kay_ou/SimTradeData/issues
- **Email**: kayou@duck.com

---

**é¡¹ç›®çŠ¶æ€**: âœ… ç¨³å®šç‰ˆ | **å½“å‰ç‰ˆæœ¬**: v0.2.0 | **æœ€åæ›´æ–°**: 2025-11-22
